function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=/*#__PURE__*/e(require("@swup/plugin"));function s(e){return"title"!==e.localName&&!e.matches("[data-swup-theme]")}function r(e,t){return e.outerHTML===t.outerHTML}function n(e){return e.matches("link[rel=stylesheet][href]")}module.exports=class extends t.default{constructor(e){void 0===e&&(e={}),super();const t=this;this.name="SwupHeadPlugin",this.requires={swup:">=4"},this.defaults={persistTags:!1,persistAssets:!1,awaitAssets:!1,timeout:3e3},this.options=void 0,this.updateHead=function(e,o){let{page:{html:i}}=o;try{const e=(new DOMParser).parseFromString(i,"text/html"),{removed:o,added:a}=function(e,t,n){let{shouldPersist:o=(()=>!1)}=void 0===n?{}:n;const i=Array.from(e.children),l=Array.from(t.children),u=(a=i,l.reduce((e,t,s)=>(a.some(e=>r(t,e))||e.push({el:t,index:s}),e),[]));var a;const d=function(e,t){return e.reduce((e,s)=>(t.some(e=>r(s,e))||e.push({el:s}),e),[])}(i,l);return d.reverse().filter(e=>{let{el:t}=e;return s(t)}).filter(e=>{let{el:t}=e;return!o(t)}).forEach(t=>{let{el:s}=t;return e.removeChild(s)}),u.filter(e=>{let{el:t}=e;return s(t)}).forEach(t=>{let{el:s,index:r=0}=t;e.insertBefore(s,e.children[r+1]||null)}),{removed:d.map(e=>{let{el:t}=e;return t}),added:u.map(e=>{let{el:t}=e;return t})}}(document.head,e.head,{shouldPersist:e=>t.isPersistentTag(e)});t.swup.log(`Removed ${o.length} / added ${a.length} tags in head`);const d=(l=document.documentElement).lang!==(u=e.documentElement).lang?(l.lang=u.lang,l.lang):null;d&&t.swup.log(`Updated lang attribute: ${d}`);const c=function(){if(t.options.awaitAssets){const s=(void 0===(e=t.options.timeout)&&(e=0),a.filter(n).map(t=>function(e,t){void 0===t&&(t=0);const s=t=>{(e=>{let{href:t}=e;return Array.from(document.styleSheets).map(e=>{let{href:t}=e;return t}).includes(t)})(e)?t():setTimeout(()=>s(t),10)};return new Promise(e=>{s(e),t>0&&setTimeout(e,t)})}(t,e))),r=function(){if(s.length)return t.swup.log(`Waiting for ${s.length} assets to load`),Promise.resolve(Promise.all(s)).then(function(){})}();if(r&&r.then)return r.then(function(){})}var e}();return Promise.resolve(c&&c.then?c.then(function(){}):void 0)}catch(e){return Promise.reject(e)}var l,u},this.options={...this.defaults,...e},this.options.persistAssets&&!this.options.persistTags&&(this.options.persistTags="link[rel=stylesheet], script[src], style")}mount(){this.before("content:replace",this.updateHead)}isPersistentTag(e){const{persistTags:t}=this.options;return"function"==typeof t?t(e):"string"==typeof t?e.matches(t):Boolean(t)}};
//# sourceMappingURL=index.cjs.map
