import e from"@swup/plugin";function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},t.apply(this,arguments)}function s(e){return"title"!==e.localName&&!e.matches("[data-swup-theme]")}function n(e,t){return e.outerHTML===t.outerHTML}function r(e){return e.matches("link[rel=stylesheet][href]")}class i extends e{constructor(e={}){var i;super(),i=this,this.name="SwupHeadPlugin",this.requires={swup:">=4"},this.defaults={persistTags:!1,persistAssets:!1,awaitAssets:!1,timeout:3e3},this.options=void 0,this.updateHead=async function(e,{page:{html:t}}){const o=(new DOMParser).parseFromString(t,"text/html"),{removed:a,added:l}=function(e,t,{shouldPersist:r=(()=>!1)}={}){const i=Array.from(e.children),o=Array.from(t.children),a=(l=i,o.reduce((e,t,s)=>(l.some(e=>n(t,e))||e.push({el:t,index:s}),e),[]));var l;const u=function(e,t){return e.reduce((e,s)=>(t.some(e=>n(s,e))||e.push({el:s}),e),[])}(i,o);return u.reverse().filter(({el:e})=>s(e)).filter(({el:e})=>!r(e)).forEach(({el:t})=>e.removeChild(t)),a.filter(({el:e})=>s(e)).forEach(({el:t,index:s=0})=>{e.insertBefore(t,e.children[s+1]||null)}),{removed:u.map(({el:e})=>e),added:a.map(({el:e})=>e)}}(document.head,o.head,{shouldPersist:e=>i.isPersistentTag(e)});i.swup.log(`Removed ${a.length} / added ${l.length} tags in head`);const u=(c=document.documentElement).lang!==(d=o.documentElement).lang?(c.lang=d.lang,c.lang):null;var c,d;if(u&&i.swup.log(`Updated lang attribute: ${u}`),i.options.awaitAssets){const e=function(e,t=0){return e.filter(r).map(e=>function(e,t=0){const s=t=>{(({href:e})=>Array.from(document.styleSheets).map(({href:e})=>e).includes(e))(e)?t():setTimeout(()=>s(t),10)};return new Promise(e=>{s(e),t>0&&setTimeout(e,t)})}(e,t))}(l,i.options.timeout);e.length&&(i.swup.log(`Waiting for ${e.length} assets to load`),await Promise.all(e))}},this.options=t({},this.defaults,e),this.options.persistAssets&&!this.options.persistTags&&(this.options.persistTags="link[rel=stylesheet], script[src], style")}mount(){this.before("content:replace",this.updateHead)}isPersistentTag(e){const{persistTags:t}=this.options;return"function"==typeof t?t(e):"string"==typeof t?e.matches(t):Boolean(t)}}export{i as default};
//# sourceMappingURL=index.modern.js.map
